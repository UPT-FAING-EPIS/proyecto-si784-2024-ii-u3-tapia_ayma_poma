name: Mutation Tests

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  mutation-tests:
    runs-on: ubuntu-latest

    steps:
    # Clona el c贸digo del repositorio
    - name: Checkout code
      uses: actions/checkout@v3

    # Configura PHP
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: xdebug # Necesario para la cobertura de c贸digo

    # Instala las dependencias de Composer
    - name: Install dependencies
      run: |
        cd project
        composer install

    # Corrige permisos para el directorio de informes
    - name: Fix permissions for mutation report directory
      run: |
        chmod -R 777 project/informes/mutacion

    # Genera la cobertura de c贸digo en formato XML
    - name: Generate PHPUnit coverage (XML)
      run: |
        cd project
        php vendor/bin/phpunit --coverage-xml=coverage

    # Ejecuta las pruebas de mutaci贸n con Infection
    - name: Run Infection mutation tests
      run: |
        cd project
        php vendor/bin/infection --coverage=coverage --log-file=informes/mutacion/infection-log.txt

    # (Opcional) Sube el informe de Infection como artefacto
    - name: Upload mutation test report as artifact
      uses: actions/upload-artifact@v3
      with:
        name: infection-mutation-report
        path: project/informes/mutacion/infection-log.txt
